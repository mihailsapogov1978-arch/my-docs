import pandas as pd
import numpy as np
from datetime import datetime
from collections import Counter
import os
import re
from openpyxl import load_workbook

def categorize_issue(topic, description):
    """
    –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫—É –ø–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è
    """
    text = str(topic).lower() + " " + str(description).lower()
    
    # 1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
    tech_keywords = [
        '–∑–∞–ø—É—Å–∫', '–æ–±–Ω–æ–≤–ª', '–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞', '–¥–æ—Å—Ç—É–ø', '–ø–∞—Ä–æ–ª', '–≤—Ö–æ–¥', '–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü',
        '–∑–∞–≤–∏—Å', '—Ç–æ—Ä–º–æ–∑', '–æ—à–∏–±–∫–∞', '–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç', '–Ω–µ –∑–∞—Ö–æ–¥–∏—Ç', '—ç–ø', '—ç—Ü–ø',
        '–ø–æ–¥–ø–∏—Å', '—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç', '—Ç–µ—Ö–Ω–∏—á', '—Å–±–æ–π', '—Ä–∞–±–æ—Ç–∞–µ—Ç', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
        '–≤–µ—Ä—Å–∏—è', '—É—Å—Ç–∞–Ω–æ–≤–∫', '–∏–Ω—Å—Ç–∞–ª–ª', '–∫–ª–∏–µ–Ω—Ç', '–≤–µ–±', '–±—Ä–∞—É–∑–µ—Ä', '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç'
    ]
    
    # 2. –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π —É—á–µ—Ç –∏ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏–µ
    accounting_keywords = [
        '–±—É—Ö–≥–∞–ª—Ç–µ—Ä', '—É—á–µ—Ç', '–æ–ø–µ—Ä–∞—Ü', '–ø—Ä–æ–≤–æ–¥–∫', '—Å—á–µ—Ç', '–¥–µ–±–µ—Ç', '–∫—Ä–µ–¥–∏—Ç',
        '–∑–∞—Ä–ø–ª–∞—Ç', '–∑–∞—Ä–∞–±–æ—Ç–Ω', '–æ–ø–ª–∞—Ç', '–≤—ã–ø–ª–∞—Ç', '–Ω–∞—á–∏—Å–ª', '—É–¥–µ—Ä–∂–∞–Ω', '–ø—Ä–µ–º–∏',
        '–Ω–∞–ª–æ–≥', '–Ω–¥—Ñ–ª', '—Å—Ç—Ä–∞—Ö–æ–≤', '–≤–∑–Ω–æ—Å', '—Ñ—Å—Å', '–ø—Ñ—Ä', '–ø–µ—Ä–∏–æ–¥', '–∑–∞–∫—Ä—ã—Ç',
        '–æ—Ç—á–µ—Ç–Ω', '–±–∞–ª–∞–Ω—Å', '–ø—Ä–∏–±—ã–ª', '—É–±—ã—Ç–æ–∫', '–∞–º–æ—Ä—Ç–∏–∑', '–æ—Å–Ω–æ–≤–Ω', '–∫–∞—Å—Å',
        '–±–∞–Ω–∫', '–ø–ª–∞—Ç–µ–∂', '–ø–æ—Ä—É—á–µ–Ω', '–∞–≤–∞–Ω—Å'
    ]
    
    # 3. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
    external_keywords = [
        '—Ä–∫—Å', '–µ–∏—Å', '–≥–∏—Å –∏–º—É—â–µ—Å—Ç–≤–æ', '–±–∞–Ω–∫', '–ø–ª–∞—Ç–µ–∂', '–ø–æ—Ä—É—á–µ–Ω', '–≤—ã–ø–∏—Å–∫',
        '–∫–∞–∑–Ω–∞—á–µ–π', '—Ñ–∏–Ω', '–±—é–¥–∂–µ—Ç', '–≥–æ—Å–∑–∞–∫—É–ø', '–∑–∞–∫—É–ø–∫', '—Ç–µ–Ω–¥–µ—Ä', '–∫–æ–Ω–∫—É—Ä—Å',
        '—ç–ª–µ–∫—Ç—Ä–æ–Ω', '—ç–¥', '–¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç', '–∞—Ä—Ö–∏–≤', '—Ö—Ä–∞–Ω–µ–Ω', '–æ—Ñ–¥', '–æ–ø–µ—Ä–∞—Ç–æ—Ä'
    ]
    
    # 4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
    reporting_keywords = [
        '–æ—Ç—á–µ—Ç–Ω–æ—Å—Ç', '—Ñ–Ω—Å', '—Å—Ñ—Ä', '—Ä–æ—Å—Å—Ç–∞—Ç', '–∞—Å—Ç—Ä–∞–ª', '–∫–æ–Ω—Ç—É—Ä', '—Ç–∞–∫—Å–∫–æ–º',
        '—Å–∑–≤', '—Ä—Å–≤', '4-—Ñ—Å—Å', '2-–Ω–¥—Ñ–ª', '6-–Ω–¥—Ñ–ª', '–±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤',
        '—Å—Ç–∞—Ç–∏—Å—Ç–∏—á', '–¥–µ–∫–ª–∞—Ä–∞—Ü', '–Ω–∞–ª–æ–≥–æ–≤'
    ]
    
    # 5. –ö–∞–¥—Ä–æ–≤—ã–π —É—á–µ—Ç
    hr_keywords = [
        '–∫–∞–¥—Ä', '—Å–æ—Ç—Ä—É–¥–Ω–∏–∫', '—Ä–∞–±–æ—Ç–Ω–∏–∫', '–ø–µ—Ä—Å–æ–Ω–∞–ª', '–≥–∏—Å —Ç–∫', '—Å–∑–≤-—Ç–¥',
        '—Ç—Ä—É–¥', '–±–æ–ª—å–Ω–∏—á–Ω', '–æ—Ç–ø—É—Å–∫', '–æ—Ç–≥—É–ª', '–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤', '—Å—Ç–∞–∂', '—Ç–∫',
        '—Ç—Ä—É–¥–æ–≤–æ–π', '–¥–æ–≥–æ–≤–æ—Ä', '–∫–æ–Ω—Ç—Ä–∞–∫—Ç', '–ø—Ä–∏–µ–º', '—É–≤–æ–ª—å–Ω–µ–Ω', '–ø–µ—Ä–µ–≤–æ–¥',
        '–≥–∏—Å –∫—É', '–≥–∏—Å –µ—Å–∫—É', '–µ–¥–∏–Ω—ã–π', '—Ä–µ–µ—Å—Ç—Ä'
    ]
    
    # 6. –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–¥–æ—Ç—á–µ—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞
    personal_keywords = [
        '–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç', '–ª–∫', '–ø–æ–¥–æ—Ç—á–µ—Ç–Ω', '–∞–≤–∞–Ω—Å–æ–≤', '–æ—Ç—á–µ—Ç', '–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á',
        '–ø–æ–¥–æ—Ç—á–µ—Ç–Ω–æ–µ –ª–∏—Ü–æ', '—Ñ–∏–∑ –ª–∏—Ü–æ', '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å–∫–∏–π'
    ]
    
    # 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ —Å–µ—Ä–≤–∏—Å—ã
    additional_keywords = [
        '–∞–Ω–∞–ª–∏—Ç–∏–∫', '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω', '–±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω', '–∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü', '–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥',
        '–∫–æ–Ω—Ç—Ä–æ–ª', '–∞–ø–∏', '–∏–Ω—Ç–µ–≥—Ä–∞—Ü', 'api', '–≤–µ–±-—Å–µ—Ä–≤–∏—Å', '—Å–µ—Ä–≤–∏—Å', '–º–æ–¥—É–ª—å',
        '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω', '—Ä–∞—Å—à–∏—Ä–µ–Ω', '–Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª'
    ]
    
    # 8. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
    directory_keywords = [
        '—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫', '–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä', '–∏–Ω–Ω', '–∫–ø–ø', '–æ–≥—Ä–Ω', '–∑–∞–¥–≤–æ–µ–Ω',
        '–¥—É–±–ª–∏–∫–∞—Ç', '–ø–æ–≤—Ç–æ—Ä', '–∞–Ω–∞–ª–∏—Ç–∏–∫', '–∏–µ—Ä–∞—Ä—Ö–∏', '—Å—Ç—Ä—É–∫—Ç—É—Ä', '–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω',
        '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü', '–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç', '–ø–æ—Å—Ç–∞–≤—â–∏–∫', '–ø–æ–∫—É–ø–∞—Ç–µ–ª—å', '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤',
        '–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä', '–º–∞—Ç–µ—Ä–∏–∞–ª', '–æ—Å', '–æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞', '–º–Ω–æ–≥'
    ]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    categories = {
        '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã': any(keyword in text for keyword in tech_keywords),
        '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π —É—á–µ—Ç': any(keyword in text for keyword in accounting_keywords),
        '–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã': any(keyword in text for keyword in external_keywords),
        '–†–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å': any(keyword in text for keyword in reporting_keywords),
        '–ö–∞–¥—Ä–æ–≤—ã–π —É—á–µ—Ç': any(keyword in text for keyword in hr_keywords),
        '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç': any(keyword in text for keyword in personal_keywords),
        '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª': any(keyword in text for keyword in additional_keywords),
        '–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏': any(keyword in text for keyword in directory_keywords)
    }
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    for category, matches in categories.items():
        if matches:
            return category
    
    return '–î—Ä—É–≥–æ–µ'

def parse_excel_to_md(excel_path, md_path):
    """
    –ü–∞—Ä—Å–∏—Ç Excel —Ñ–∞–π–ª —Å –∑–∞—è–≤–∫–∞–º–∏ –∏ –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢ –æ—Ç—á–µ—Ç –≤ markdown —Ñ–∞–π–ª
    """
    
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º Excel —Ñ–∞–π–ª
        wb = load_workbook(excel_path, data_only=True)
        ws = wb.active
        
        print(f"üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª: {excel_path}")
        print(f"   –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ: {ws.max_row}")
        
        # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã
        header_row = None
        for i in range(1, min(10, ws.max_row + 1)):
            cell_value = ws.cell(row=i, column=1).value
            if cell_value in ['–ù–æ–º–µ—Ä', 1, '1']:
                header_row = i
                print(f"‚úÖ –ù–∞–π–¥–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ —Å—Ç—Ä–æ–∫–µ {i}")
                break
        
        if header_row:
            # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—è —Å –Ω–∞–π–¥–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            df = pd.read_excel(excel_path, header=header_row-1)
        else:
            # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å 4-–π —Å—Ç—Ä–æ–∫–∏ (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)
            df = pd.read_excel(excel_path, header=3)
            print("‚ö†Ô∏è –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫—É 4")
        
        print(f"‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –°—Ç—Ä–æ–∫: {len(df)}, –ö–æ–ª–æ–Ω–æ–∫: {len(df.columns)}")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
        return None
    
    # –û—á–∏—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
    df.columns = [str(col).strip() for col in df.columns]
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ (–ø–æ–∏—Å–∫ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏—è–º –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞)
    column_mapping = {}
    
    # –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
    column_patterns = {
        '–ù–æ–º–µ—Ä': ['–Ω–æ–º–µ—Ä', '‚Ññ', '1'],
        '–î–∞—Ç–∞': ['–¥–∞—Ç–∞', '–≤—Ä–µ–º—è', '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü', '2'],
        '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä': ['–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä', '–∑–∞—è–≤–∫–∏', '3'],
        '–°—Ç–∞—Ç—É—Å': ['—Å—Ç–∞—Ç—É—Å', '–æ–±—Ä–∞—â–µ–Ω', '4'],
        '–¢–µ–º–∞': ['—Ç–µ–º–∞', '5'],
        '–û–ø–∏—Å–∞–Ω–∏–µ': ['–æ–ø–∏—Å–∞–Ω–∏–µ', '6'],
        '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å': ['–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '7'],
        '–†–µ—à–µ–Ω–∏–µ': ['—Ä–µ—à–µ–Ω–∏–µ', '8'],
        '–£—Å–ª—É–≥–∞': ['—É—Å–ª—É–≥–∞', '9']
    }
    
    print(f"\nüîç –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏:")
    for col_name, patterns in column_patterns.items():
        for pattern in patterns:
            for df_col in df.columns:
                if pattern in str(df_col).lower():
                    column_mapping[col_name] = df_col
                    print(f"   ‚Ä¢ {col_name}: '{df_col}'")
                    break
            if col_name in column_mapping:
                break
    
    # –°–æ–∑–¥–∞–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ—Ç—á–µ—Ç–∞
    report_time = datetime.now().strftime("%d.%m.%Y %H:%M")
    
    # 1. –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫
    total_requests = len(df)
    print(f"\nüìä –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {total_requests}")
    
    # 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    if '–°—Ç–∞—Ç—É—Å' in column_mapping:
        status_col = column_mapping['–°—Ç–∞—Ç—É—Å']
        status_series = df[status_col].dropna()
        if len(status_series) > 0:
            status_series = status_series.astype(str).str.strip()
            status_counts = status_series.value_counts()
            print(f"üìä –°—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: {len(status_counts)}")
        else:
            status_counts = pd.Series(dtype='object')
    else:
        status_counts = pd.Series(dtype='object')
    
    # 3. –ê–Ω–∞–ª–∏–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π - –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ
    org_requests = {}
    
    # –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É
    first_col = df.columns[0]
    print(f"üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–æ–Ω–∫—É '{first_col}' –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π")
    
    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º –∏ —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    current_org = None
    
    for idx, row in df.iterrows():
        org_value = row[first_col]
        
        if pd.notna(org_value) and isinstance(org_value, str):
            org_str = str(org_value).strip()
            org_upper = org_str.upper()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
            org_keywords = ['–ê–û', '–î–ï–ü–ê–†–¢–ê–ú–ï–ù–¢', '–£–ü–†–ê–í–õ–ï–ù–ò–ï', '–£–ß–†–ï–ñ–î–ï–ù–ò–ï', 
                           '–ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù', '–ú–£–ù–ò–¶–ò–ü–ê–õ–¨–ù', '–û–ö–†–£–ì', '–Ø–ù–ê–û',
                           '–Ø–ú–ê–õ–û-–ù–ï–ù–ï–¶–ö–ò–ô', '–ë–Æ–î–ñ–ï–¢–ù–û–ï', '–ö–ê–ó–ï–ù–ù–û–ï', '–ê–í–¢–û–ù–û–ú–ù–û–ï']
            
            if any(keyword in org_upper for keyword in org_keywords) and len(org_str) > 10:
                # –≠—Ç–æ –Ω–æ–≤–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
                current_org = org_str
                if current_org not in org_requests:
                    org_requests[current_org] = 0
            elif current_org:
                # –≠—Ç–æ –∑–∞—è–≤–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                org_requests[current_org] = org_requests.get(current_org, 0) + 1
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π: {len(org_requests)}")
    
    # 4. –°—É–º–º–∏—Ä—É–µ–º –∑–∞—è–≤–∫–∏ –ø–æ —Ç–∏–ø–∞–º —É—á—Ä–µ–∂–¥–µ–Ω–∏–π
    gov_requests = 0
    mun_requests = 0
    
    gov_keywords = ['–ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù', '–ì–ö–£', '–ì–£', '–ì–ë–£', '–ì–ê–£', '–ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–û–ï', '–ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–´–ô']
    mun_keywords = ['–ú–£–ù–ò–¶–ò–ü–ê–õ–¨–ù', '–ú–ö–£', '–ú–£', '–ú–ê–£', '–ú–ë–£', '–ú–£–ù–ò–¶–ò–ü–ê–õ–¨–ù–û–ï', '–ú–£–ù–ò–¶–ò–ü–ê–õ–¨–ù–´–ô']
    
    for org, count in org_requests.items():
        org_upper = org.upper()
        if any(keyword in org_upper for keyword in gov_keywords):
            gov_requests += count
        elif any(keyword in org_upper for keyword in mun_keywords):
            mun_requests += count
    
    print(f"üìä –¢–∏–ø—ã —É—á—Ä–µ–∂–¥–µ–Ω–∏–π: –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ - {gov_requests}, –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ - {mun_requests}")
    
    # 5. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
    issue_categories = {}
    
    if '–¢–µ–º–∞' in column_mapping and '–û–ø–∏—Å–∞–Ω–∏–µ' in column_mapping:
        theme_col = column_mapping['–¢–µ–º–∞']
        desc_col = column_mapping['–û–ø–∏—Å–∞–Ω–∏–µ']
        
        print(f"\nüîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è...")
        
        # –ë–µ—Ä–µ–º –≤—ã–±–æ—Ä–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–ø–µ—Ä–≤—ã–µ 200 –∑–∞—è–≤–æ–∫ –∏–ª–∏ –≤—Å–µ, –µ—Å–ª–∏ –º–µ–Ω—å—à–µ)
        sample_size = min(200, len(df))
        
        for idx in range(sample_size):
            row = df.iloc[idx]
            topic = row[theme_col] if pd.notna(row.get(theme_col)) else ''
            description = row[desc_col] if pd.notna(row.get(desc_col)) else ''
            category = categorize_issue(topic, description)
            issue_categories[category] = issue_categories.get(category, 0) + 1
        
        print(f"‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ {sample_size} –∑–∞—è–≤–æ–∫")
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞—è–≤–æ–∫
    sorted_issues = sorted(issue_categories.items(), key=lambda x: x[1], reverse=True)
    
    # –°–æ–∑–¥–∞–µ–º –ü–û–õ–ù–û–°–¢–¨–Æ –ù–û–í–´–ô markdown –æ—Ç—á–µ—Ç (–ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–ú —Ñ–∞–π–ª)
    md_content = f"""# üìä –û—Ç—á–µ—Ç –ø–æ –∑–∞—è–≤–∫–∞–º
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: {report_time}*  
*–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {total_requests}*

## –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

### –¢–∏–ø—ã —É—á—Ä–µ–∂–¥–µ–Ω–∏–π

| –¢–∏–ø —É—á—Ä–µ–∂–¥–µ–Ω–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ |
|----------------|-------------------|
| –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è | {gov_requests} |
| –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è | {mun_requests} |

---

### –°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–æ–∫

| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –î–æ–ª—è |
|--------|------------|------|
"""
    
    if len(status_counts) > 0:
        for status, count in status_counts.items():
            percentage = round((count / total_requests) * 100, 1)
            status_display = str(status)[:20] + ('...' if len(str(status)) > 20 else '')
            md_content += f"| {status_display} | {count} | {percentage}% |\n"
    else:
        md_content += "| *–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö* | 0 | 0% |\n"
    
    md_content += """
### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| ‚Ññ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ | –î–æ–ª—è |
|---|-------------------|-------------------|------|
"""
    
    if sorted_issues:
        sample_total = sum(issue_categories.values())
        for i, (category, count) in enumerate(sorted_issues, 1):
            percentage = round((count / sample_total) * 100, 1) if sample_total > 0 else 0
            md_content += f"| {i} | {category} | {count} | {percentage}% |\n"
    else:
        md_content += "| 1 | *–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞* | 0 | 0% |\n"
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–µ—Ä–µ–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    md_content += "\n---\n\n"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
    os.makedirs(os.path.dirname(md_path), exist_ok=True)
    
    # –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–ú –§–ê–ô–õ (mode='w' - write, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å)
    with open(md_path, 'w', encoding='utf-8') as f:
        f.write(md_content)
    
    print(f"\n‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –ü–ï–†–ï–ó–ê–ü–ò–°–ê–ù: {md_path}")
    print(f"üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∑–∞—è–≤–æ–∫: {total_requests}")
    print(f"üè¢ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è: {gov_requests} –∑–∞—è–≤–æ–∫")
    print(f"üè¢ –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è: {mun_requests} –∑–∞—è–≤–æ–∫")
    print(f"üîç –ù–∞–π–¥–µ–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π: {len(org_requests)}")
    print(f"üìã –ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–±–ª–µ–º: {len(issue_categories)}")
    
    return {
        'total_requests': total_requests,
        'gov_requests': gov_requests,
        'mun_requests': mun_requests,
        'status_counts': dict(status_counts),
        'issue_categories': dict(sorted_issues)
    }

def generate_zayavky_report():
    """
    –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ zayavky.xlsx (–ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏") 
    –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ zayavky.md
    """
    print(f"\nüìñ –ß–∏—Ç–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª: zayavky.xlsx")
    
    try:
        # –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ Excel (–ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏")
        file_path = "zayavky.xlsx"
        
        if not os.path.exists(file_path):
            print(f"‚ùå –§–∞–π–ª {file_path} –Ω–µ –Ω–∞–π–¥–µ–Ω!")
            return False
        
        # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏"
        try:
            df = pd.read_excel(file_path, sheet_name="–ó–∞—è–≤–∫–∏", dtype=str)
            print(f"‚úÖ –õ–∏—Å—Ç '–ó–∞—è–≤–∫–∏' –ø—Ä–æ—á–∏—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ")
        except:
            # –ï—Å–ª–∏ –ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
            print("‚ö†Ô∏è –õ–∏—Å—Ç '–ó–∞—è–≤–∫–∏' –Ω–µ –Ω–∞–π–¥–µ–Ω, —á–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç")
            df = pd.read_excel(file_path, dtype=str)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        required_columns = ['–°—Ç–∞—Ç—É—Å', '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä']
        missing_columns = [col for col in required_columns if col not in df.columns]
        
        if missing_columns:
            print(f"‚ö†Ô∏è –í —Ñ–∞–π–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: {missing_columns}")
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ —Å –ø–æ—Ö–æ–∂–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
            for col in required_columns:
                for df_col in df.columns:
                    if col.lower() in df_col.lower():
                        df.rename(columns={df_col: col}, inplace=True)
                        print(f"   ‚Ä¢ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ '{df_col}' –≤ '{col}'")
                        break
        
        # 1. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        total = len(df)
        print(f"üìä –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫ –≤ zayavky.xlsx: {total}")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
        if '–°—Ç–∞—Ç—É—Å' in df.columns:
            # –ü—Ä–∏–≤–æ–¥–∏–º –∫ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É —Ç–∏–ø—É –∏ –æ—á–∏—â–∞–µ–º
            df['–°—Ç–∞—Ç—É—Å'] = df['–°—Ç–∞—Ç—É—Å'].astype(str).str.strip()
            
            resolved = df[df['–°—Ç–∞—Ç—É—Å'].str.contains('–†–µ—à–µ–Ω', case=False, na=False)].shape[0]
            in_work = df[df['–°—Ç–∞—Ç—É—Å'].str.contains('–í —Ä–∞–±–æ—Ç–µ', case=False, na=False)].shape[0]
            closed = df[df['–°—Ç–∞—Ç—É—Å'].str.contains('–ó–∞–∫—Ä—ã—Ç', case=False, na=False)].shape[0]
            
            print(f"   ‚Ä¢ –†–µ—à–µ–Ω–æ: {resolved}")
            print(f"   ‚Ä¢ –í —Ä–∞–±–æ—Ç–µ: {in_work}")
            print(f"   ‚Ä¢ –ó–∞–∫—Ä—ã—Ç–æ: {closed}")
        else:
            resolved = 0
            in_work = 0
            closed = 0
            print("‚ö†Ô∏è –ö–æ–ª–æ–Ω–∫–∞ '–°—Ç–∞—Ç—É—Å' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
        
        # 2. –¢–æ–ø-3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–≤
        top_3_table = ""
        if '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä' in df.columns:
            # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–≤
            df['–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä'] = df['–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä'].astype(str).str.strip()
            initiator_counts = df['–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä'].value_counts().head(3)
            
            if not initiator_counts.empty:
                # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ç–æ–ø-3
                top_3_table = "| –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ |\n|:---|---:|\n"
                for name, count in initiator_counts.items():
                    # –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞
                    name_display = str(name)[:30] + ('...' if len(str(name)) > 30 else '')
                    top_3_table += f"| {name_display} | {count} |\n"
                
                print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(initiator_counts)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–≤")
            else:
                top_3_table = "*–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞—Ö*\n"
                print("‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞—Ö")
        else:
            top_3_table = "*–ö–æ–ª–æ–Ω–∫–∞ '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞*\n"
            print("‚ö†Ô∏è –ö–æ–ª–æ–Ω–∫–∞ '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ Markdown
        md_content = f"""
## üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–∏–∑ zayavky.xlsx)

### 1. –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫:** {total}  
**–ò–∑ –Ω–∏—Ö:**
- –†–µ—à–µ–Ω–æ: {resolved}
- –í —Ä–∞–±–æ—Ç–µ: {in_work} 
- –ó–∞–∫—Ä—ã—Ç–æ: {closed}
- –û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏: {total - resolved - in_work - closed}

### 2. –¢–æ–ø-3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–≤

{top_3_table}

*–î–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞: zayavky.xlsx (–ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏")*
"""
        
        return md_content
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ zayavky.xlsx: {e}")
        return False

if __name__ == "__main__":
    # –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
    excel_file = "zayavky_all.xlsx"
    md_file = "docs/zayavky.md"
    
    print("="*60)
    print("üöÄ –ó–ê–ü–£–°–ö –ì–ï–ù–ï–†–ê–¶–ò–ò –û–¢–ß–ï–¢–ê")
    print("="*60)
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π
    if os.path.exists(md_file):
        print(f"üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª: {md_file}")
        os.remove(md_file)
    
    if os.path.exists(excel_file):
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –æ—Ç—á–µ—Ç –∏–∑ zayavky_all.xlsx
        stats = parse_excel_to_md(excel_file, md_file)
        
        if stats:
            # 2. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ zayavky.xlsx –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
            additional_content = generate_zayavky_report()
            
            if additional_content:
                # –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É
                with open(md_file, 'a', encoding='utf-8') as f:
                    f.write(additional_content)
                
                print(f"\n‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ zayavky.xlsx –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞")
            else:
                print(f"\n‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ zayavky.xlsx")
            
            print("\n" + "="*60)
            print("‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –£–°–ü–ï–®–ù–û –°–û–ó–î–ê–ù")
            print("="*60)
            print(f"üìã –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:")
            print(f"   ‚Ä¢ –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: {stats['total_requests']}")
            print(f"   ‚Ä¢ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è: {stats['gov_requests']}")
            print(f"   ‚Ä¢ –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è: {stats['mun_requests']}")
            
            if stats['issue_categories']:
                top_issue = list(stats['issue_categories'].keys())[0]
                print(f"   ‚Ä¢ –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: {top_issue}")
            
            print(f"\nüìÑ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω: {md_file}")
            print("üìÅ –°–æ–¥–µ—Ä–∂–∏—Ç:")
            print("   1. –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç—á–µ—Ç –∏–∑ zayavky_all.xlsx")
            print("   2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏–∑ zayavky.xlsx")
    else:
        print(f"‚ùå –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª {excel_file} –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ zayavky.xlsx
        if os.path.exists("zayavky.xlsx"):
            print(f"‚ö†Ô∏è –ù–æ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª zayavky.xxz - –ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –Ω–µ–≥–æ")
            
            # –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –æ—Ç—á–µ—Ç
            report_time = datetime.now().strftime("%d.%m.%Y %H:%M")
            md_content = f"""# üìä –û—Ç—á–µ—Ç –ø–æ –∑–∞—è–≤–∫–∞–º
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: {report_time}*

"""
            
            # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ zayavky.xlsx
            additional_content = generate_zayavky_report()
            
            if additional_content:
                md_content += additional_content
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                os.makedirs("docs", exist_ok=True)
                with open(md_file, 'w', encoding='utf-8') as f:
                    f.write(md_content)
                
                print(f"\n‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —Ç–æ–ª—å–∫–æ –∏–∑ zayavky.xlsx: {md_file}")
            else:
                print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç")